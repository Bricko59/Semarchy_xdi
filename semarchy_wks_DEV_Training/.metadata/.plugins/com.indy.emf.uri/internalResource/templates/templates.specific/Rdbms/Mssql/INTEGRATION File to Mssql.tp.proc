<?xml version="1.0" encoding="UTF-8"?>
<proc:process xmlns:UUID="java.util.UUID" xmlns:common="http://exslt.org/common" xmlns:mdj="java:com.indy.xsl.global.Functions" xmlns:proc="http://www.example.org/proc" xmlns:saxon="http://saxon.sf.net/" id="_7DkDYdL1Eeik8NiUR3zizA" description="This template is used for loading a file directy into a target Microsoft SQL Server table using the BULK loader or BCP utility.&#xD;&#xA;&#xD;&#xA;With this template the file is directly loaded into the target without any transformation.&#xD;&#xA;This can offer better performances than the usual 'INTEGRATION Mssql' integration template which goes through temporary tables before the final integration in target table.&#xD;&#xA;&#xD;&#xA;However, this Template therefore does not support performing transformations, rejects, or slowly changing dimensions strategies.&#xD;&#xA;If you want to perform one of those, please use the 'INTEGRATION Mssql' template instead.&#xD;&#xA;&#xD;&#xA;Refer to the description of each Parameter for more information.&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;History:&#xD;&#xA;10/01/2019  Support using BCP command to load data&#xD;&#xA;23/10/2018&#x9;'from_file_dynamic' format method was not using the row separator, field separator, and charset defined in the Metadata to read the header line&#xD;&#xA;19/10/2018 Template creation" metaInf="&lt;template-feature-support name=&quot;load&quot; enable=&quot;false&quot; evaluation=&quot;NATIVE&quot;/>" isBeginAction="false" nbCycles="-1" toleratedError="false">
  <parameter id="_7DkDbNL1Eeik8NiUR3zizA" description="If true, the operations on the target table will be executed in a dedicated transaction.&#xD;&#xA;If false, each statement on the target table uses an Autocommit transaction." name="transactionalModeOnTarget" type="Boolean" value="false"/>
  <parameter id="_7DkDY9L1Eeik8NiUR3zizA" description="If true, the temporary objects created during integration are removed at the end of the process." name="cleanTemporaryObjects " type="Boolean" value="true"/>
  <parameter id="_7DkDbtL1Eeik8NiUR3zizA" description="If true, the transactions are committed at the end of the integration.&#xD;&#xA;Please note that this option is taken into acount only if TransactionalModeOnTarget is set to true." name="commitTransaction" type="Boolean" value="true"/>
  <parameter id="_7DkDZ9L1Eeik8NiUR3zizA" description="If true, target table is truncated prior to the Integration.&#xD;&#xA;Note: If you set this option to true you probably want to load the target table with 'Append Mode' to true for better performance." name="truncateTargetTable" type="Boolean" value="false"/>
  <parameter id="_MwLdkBV6EemJ-PVUNWIcUA" description="If set to true BCP utility will connect to SQL Server with a trusted connection using integrated security (option -T).&#xD;&#xA;If set to false, BCP will use user and password configured on the target metadata server to connect (options -U and -P)." name="useTrustedConnection" type="Boolean"/>
  <parameter id="_7DkDadL1Eeik8NiUR3zizA" description="If true, all the target table rows are deleted before the integration with a DELETE statement.&#xD;&#xA;For better performance you should use truncateTargetTable when possible." metaInf="&lt;deprecated>This option is now replaced by the new option deletionStrategy&lt;/deprecated>" name="deleteAllTargetTable" type="Boolean" value="false"/>
  <parameter id="_Mv_QUBV6EemJ-PVUNWIcUA" description="Specifies the method to use for loading data into SQL Server.&#xD;&#xA;&#xD;&#xA;- BULK: &#xD;&#xA;The BULK statement is used to load the temporary files into SQL Server.&#xD;&#xA;This statement requires the temporary files to be located on the SQL Server machine to be able to load it.&#xD;&#xA;&#xD;&#xA;The 'enable File Transport' option can be used to automatically send them through FTP.&#xD;&#xA;Alternatively, you can install the Runtime executing the Mapping directly on the target SQL Server machine.&#xD;&#xA;&#xD;&#xA;To get more information on how to configure MS SQL Server metadata in this case please consult the following article on stambia.org&#xD;&#xA;http://stambia.org/doc/113-technology-articles/sql-server/221-using-bulk-load-on-a-distant-server-with-enablefiletransport-option&#xD;&#xA;&#xD;&#xA;- BCP:&#xD;&#xA;The BCP command line utility is used to load the temporary files into SQL Server.&#xD;&#xA;Make sure that the utility is available on the Runtime's machine for this mode to work." metaInf="&lt;metaInf id=&quot;value&quot;  value=&quot;BULK&quot;/>&#xD;&#xA;&lt;metaInf id=&quot;value&quot;  value=&quot;BCP&quot;/>" name="loadMethod" type="String" value="BULK"/>
  <parameter id="_Fi8zYNL2Eeik8NiUR3zizA" description="Defines how the file format should be handled.&#xD;&#xA;&#xD;&#xA;Before being loaded into SQL Server using the BULK statement, the template is generating a format file containing the columns information.&#xD;&#xA;The format file is then passed to the BULK statement when loading the file.&#xD;&#xA;This parameter defines how the columns of the format file should be calculated.&#xD;&#xA;&#xD;&#xA;- from_metadata: the list of columns is retrieved from the source file Metadata and will always be the same.&#xD;&#xA;- from_file_dynamic: the list of columns is retrieved dynamically from the file's header, allowing to have files with a number of columns and columns order which can vary between each file.&#xD;&#xA;&#xD;&#xA;Notes about &quot;from_file_dynamic&quot; method:&#xD;&#xA;This method allows to load files from which the columns may not always be at the same position and which can contain additional columns.&#xD;&#xA;The template will dynamically find the columns order from the first line of the file which is expected to be the header of the file containing the columns list.&#xD;&#xA;This will then be used to generate the correct format file with the correct column order, ignoring the additional columns which are not in the source Metadata.&#xD;&#xA;This method is supported for delimited files only.&#xD;&#xA;&#xD;&#xA;Example of dynamic file:&#xD;&#xA;First file loaded:&#xD;&#xA;CUS_ID,CUS_FIRST_NAME,CUS_LAST_NAME&#xD;&#xA;1,&quot;Jason&quot;,&quot;GIBBS&quot;&#xD;&#xA;&#xD;&#xA;Seconf file loaded:&#xD;&#xA;CUS_ID,ADDITIONAL_COLUMN,CUS_LAST_NAME,CUS_FIRST_NAME&#xD;&#xA;1,&quot;value&quot;,&quot;GIBBS&quot;,&quot;Jason&quot;&#xD;&#xA;&#xD;&#xA;=> In both cases the columns CUS_ID, CUS_FIRST_NAME and CUS_LAST_NAME which are the columns defined in the Metadata / in the Mapping will be loaded correctly.&#xD;&#xA;Even if they are not in the same order and if there is an additional column between them.&#xD;&#xA;The additional column will be ignored." metaInf="&lt;metaInf id=&quot;value&quot; value=&quot;from_metadata&quot; />&#xD;&#xA;&lt;metaInf id=&quot;value&quot; value=&quot;from_file_dynamic&quot; />" name="fileFormatMethod" type="String" value="from_metadata"/>
  <parameter id="_7DkDcNL1Eeik8NiUR3zizA" description="This option is used to choose whether to create or not the target table before the integration.&#xD;&#xA;&#xD;&#xA;- true: The target table is created. If it already exists no error is raised.&#xD;&#xA;- false: The target table is not created.&#xD;&#xA;- drop and create: The target table will be dropped, and re-created on each execution." metaInf="&lt;metaInf id=&quot;value&quot;  value=&quot;true&quot;/>&#xD;&#xA;&lt;metaInf id=&quot;value&quot;  value=&quot;false&quot;/>&#xD;&#xA;&lt;metaInf id=&quot;value&quot;  value=&quot;drop and create&quot;/>" name="createTargetTable" type="String" value="false"/>
  <parameter id="_Fi7lQNL2Eeik8NiUR3zizA" description="Specifies the codepage used to BULK insert the file.&#xD;&#xA;&#xD;&#xA;Please refer to the SQL Server BULK Insert reference documentation for more information.&#xD;&#xA;&#xD;&#xA;" name="codePage" type="String" value="ACP"/>
  <parameter id="_Fi8zYdL2Eeik8NiUR3zizA" description="The BULK loader version that should be indicated in the generated BULK insert format file" name="loaderVersion" type="String" value="9.0"/>
  <parameter id="_7DkDc9L1Eeik8NiUR3zizA" description="Name of the transaction when Transaction Mode is set to true." name="transactionName" type="String" value="T1"/>
  <subProcess id="_7DkDetL1Eeik8NiUR3zizA" name="Prepare">
    <link id="_7DkDe9L1Eeik8NiUR3zizA" executionType="OK" generationType="OK" mandatory="1" targetId="_7DkD3NL1Eeik8NiUR3zizA?fileId=_7DkDYdL1Eeik8NiUR3zizA$type=proc$name=Integration?"/>
    <parameter id="_7DkDfNL1Eeik8NiUR3zizA" name="TPL_STEP" type="String" value="Integration.BeforeControl"/>
    <actionCode id="_7DkDfdL1Eeik8NiUR3zizA" generationCondition="'${createTargetTable}$'='true' or '${createTargetTable}$'='drop and create'" isBeginAction="false" name="Creation of target table " nbCycles="-1" toleratedError="true" technology="com.indy.engine.actionCodes.JdbcActionCodeI">
      <link id="_7DkDftL1Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_7DkDl9L1Eeik8NiUR3zizA"/>
      <parameter id="_7DkDf9L1Eeik8NiUR3zizA" name="SQL_CONNECTION" type="String" value="%targetConnection{$REF}%"/>
      <parameter id="_7DkDgNL1Eeik8NiUR3zizA" name="SQL_ACTION_TYPE" type="String" value="DDL_DML"/>
      <parameter id="_7DkDgdL1Eeik8NiUR3zizA" name="SQL_TRANSACTION_TYPE" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then 'NOCOMMIT' else 'AUTOCOMMIT' }x%"/>
      <parameter id="_7DkDgtL1Eeik8NiUR3zizA" name="SQL_TRANSACTION_NAME" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then md:paramValue($this,'transactionName') else '' }x%"/>
      <code>%x{md:applyMask($REF/ref:target(),'TABLE_CREATION_DDL', $REF/ref:target(),true(),true(),false(),false(),None,false(),false(),false(),false())}x%</code>
    </actionCode>
    <actionCode id="_7DkDkNL1Eeik8NiUR3zizA" generationCondition="$deletionStrategy='all rows' or $deletionStrategy='where clause'" isBeginAction="false" name="Deletion of target table" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.JdbcActionCodeI">
      <parameter id="_7DkDktL1Eeik8NiUR3zizA" name="SQL_CONNECTION" type="String" value="%targetConnection{$REF}%"/>
      <parameter id="_7DkDk9L1Eeik8NiUR3zizA" name="SQL_ACTION_TYPE" type="String" value="DDL_DML"/>
      <parameter id="_7DkDlNL1Eeik8NiUR3zizA" name="SQL_TRANSACTION_TYPE" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then 'NOCOMMIT' else 'AUTOCOMMIT' }x%"/>
      <parameter id="_7DkDldL1Eeik8NiUR3zizA" name="SQL_ACTION_TYPE_STAT" type="String" value="DELETE"/>
      <parameter id="_7DkDltL1Eeik8NiUR3zizA" name="SQL_TRANSACTION_NAME" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then md:paramValue($this,'transactionName') else '' }x%"/>
      <code>Delete from %x{md:physicalPath($REF/ref:target())}x%&#xD;
%x{if($deletionStrategy='where clause') then md:encloseIfNotEmpty(md:paramValue($this,'deletionWhereClause'),'where ','') else ''}x%</code>
    </actionCode>
    <actionCode id="_7DkDl9L1Eeik8NiUR3zizA" generationCondition="'${truncateTargetTable}$'='true'" isBeginAction="false" name="Truncation of target table" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.JdbcActionCodeI">
      <link id="_7DkDmNL1Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_7DkDkNL1Eeik8NiUR3zizA"/>
      <parameter id="_7DkDmdL1Eeik8NiUR3zizA" name="SQL_CONNECTION" type="String" value="%targetConnection{$REF}%"/>
      <parameter id="_7DkDmtL1Eeik8NiUR3zizA" name="SQL_ACTION_TYPE" type="String" value="DDL_DML"/>
      <parameter id="_7DkDm9L1Eeik8NiUR3zizA" name="SQL_TRANSACTION_TYPE" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then 'NOCOMMIT' else 'AUTOCOMMIT' }x%"/>
      <parameter id="_7DkDnNL1Eeik8NiUR3zizA" name="SQL_TRANSACTION_NAME" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then md:paramValue($this,'transactionName') else '' }x%"/>
      <code>Truncate table %x{md:physicalPath($REF/ref:target())}x%</code>
    </actionCode>
    <actionCode id="_7DkDvdL1Eeik8NiUR3zizA" generationCondition="'${createTargetTable}$'='drop and create'" isBeginAction="false" name="Drop of target table " nbCycles="-1" toleratedError="true" technology="com.indy.engine.actionCodes.JdbcActionCodeI">
      <link id="_7DkDvtL1Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_7DkDfdL1Eeik8NiUR3zizA"/>
      <parameter id="_7DkDv9L1Eeik8NiUR3zizA" name="SQL_CONNECTION" type="String" value="%targetConnection{$REF}%"/>
      <parameter id="_7DkDwNL1Eeik8NiUR3zizA" name="SQL_ACTION_TYPE" type="String" value="DDL_DML"/>
      <parameter id="_7DkDwdL1Eeik8NiUR3zizA" name="SQL_TRANSACTION_TYPE" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then 'NOCOMMIT' else 'AUTOCOMMIT' }x%"/>
      <parameter id="_7DkDwtL1Eeik8NiUR3zizA" name="SQL_TRANSACTION_NAME" type="String" value="%x{if (md:paramValue($this,'transactionalModeOnTarget')='true') then md:paramValue($this,'transactionName') else '' }x%"/>
      <code>drop table %x{md:physicalPath($REF/ref:target())}x%</code>
    </actionCode>
    <templateType>I-TP.RDBMS.PREPARING</templateType>
    <xslVariable id="_7DkD2tL1Eeik8NiUR3zizA" code="exists($REF/ref:target()/ref:columns()/tech:scdCode())" name="existsScd" type="xpath"/>
    <xslVariable id="_7DkD29L1Eeik8NiUR3zizA" code="if (md:paramValue($this,'deleteAllTargetTable')='true') then 'all rows'&#xD;&#xA;else if (md:paramValue($this,'deletionStrategy') = 'update key') then 'key'&#xD;&#xA;else md:paramValue($this,'deletionStrategy')" name="deletionStrategy" type="xpath"/>
  </subProcess>
  <subProcess id="_7DkD3NL1Eeik8NiUR3zizA" name="Integration">
    <parameter id="_7DkD3dL1Eeik8NiUR3zizA" name="TPL_STEP" type="String" value="Integration.AfterControl"/>
    <actionCode id="_L6oHINL2Eeik8NiUR3zizA" isBeginAction="false" name="Delete bad error file" nbCycles="-1" toleratedError="true" technology="com.indy.engine.actionCodes.FileDeleteActionCodeI">
      <link id="_L6oHIdL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6qjYNL2Eeik8NiUR3zizA"/>
      <parameter id="_L6oHItL2Eeik8NiUR3zizA" name="DEL_FILE" type="String" value="%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.bad.Error.Txt"/>
    </actionCode>
    <actionCode id="_L6pVQNL2Eeik8NiUR3zizA" generationCondition="'${fileFormatMethod}$' = 'from_file_dynamic'" isBeginAction="false" name="Calculate columns lists" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6pVQdL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6rxhtL2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6pVR9L2Eeik8NiUR3zizA" generationCondition="$REF/tech:sourceRef()/tech:type() = 'P'" isBeginAction="false" name="Positional Format File" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.WriteTxtFileActionCodeI">
      <link id="_WFb30BTtEemJ-PVUNWIcUA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_4pqC0BlsEemU3dBcazn2tQ"/>
      <parameter id="_L6pVSdL2Eeik8NiUR3zizA" description="Name of the file" name="TXT_WRITE_FILENAME" type="String" value="%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.fmt"/>
      <code>%x{md:paramValue($this,'loaderVersion')}x%&#xD;
%x{count($REF/ref:sources()[1]/ref:columns())}x%&#xD;
%xsl preserveSpace=&quot;false&quot;{&#xD;
%x{md:list($cols/col[@isLast='false']/@linePos,'\n','','\n')}x%&#xD;
%x{md:list($cols/col[@isLast='true']/@lineBegPos,'')}x%%x{$sourceFile/tech:asciiLineSeparator()}x%%x{md:list($cols/col[@isLast='true']/@lineEnd,'\n')}x%&#xD;
}xsl%&#xD;
&#xD;
</code>
    </actionCode>
    <actionCode id="_L6pVStL2Eeik8NiUR3zizA" generationCondition="'${fileFormatMethod}$' = 'from_file_dynamic'" isBeginAction="false" name="columns calculation end" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6pVS9L2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6qjcdL2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6pVTNL2Eeik8NiUR3zizA" generationCondition="$REF/tech:sourceRef()/tech:type() = 'D' and not('${fileFormatMethod}$' = 'from_file_dynamic')" isBeginAction="false" name="Delimited Format File" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.WriteTxtFileActionCodeI">
      <link id="_L6pVTdL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_4pqC0BlsEemU3dBcazn2tQ"/>
      <parameter id="_L6pVTtL2Eeik8NiUR3zizA" description="Name of the file" name="TXT_WRITE_FILENAME" type="String" value="%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.fmt"/>
      <code>%x{md:paramValue($this,'loaderVersion')}x%&#xD;
%x{count($REF/ref:sources()[1]/ref:columns())}x%&#xD;
%xsl preserveSpace=&quot;false&quot;{&#xD;
%x{mds:replace(md:list($cols/col[@isLast='false']/@lineDelim,'\n','','\n'),'___FIELD_SEP___',$asciiFieldSeparator)}x%&#xD;
%x{mds:replace(md:list($cols/col[@isLast='true']/@lineBegDelim,''),'___FIELD_SEP___',$asciiFieldSeparator)}x%%x{$sourceFile/tech:asciiLineSeparator()}x%%x{md:list($cols/col[@isLast='true']/@lineEnd,'\n')}x%&#xD;
}xsl%&#xD;
&#xD;
</code>
    </actionCode>
    <actionCode id="_L6qjYNL2Eeik8NiUR3zizA" isBeginAction="false" name="Delete bad file" nbCycles="-1" toleratedError="true" technology="com.indy.engine.actionCodes.FileDeleteActionCodeI">
      <link id="_L6qjYdL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6rxgNL2Eeik8NiUR3zizA"/>
      <parameter id="_L6qjYtL2Eeik8NiUR3zizA" name="DEL_FILE" type="String" value="%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.bad"/>
    </actionCode>
    <actionCode id="_L6qjY9L2Eeik8NiUR3zizA" generationCondition="'${fileFormatMethod}$' = 'from_file_dynamic'" isBeginAction="false" name="Calculate dynamic columns list" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.BeanScriptingActionCodeI">
      <link id="_L6qjZNL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6pVStL2Eeik8NiUR3zizA"/>
      <parameter id="_L6qjZdL2Eeik8NiUR3zizA" name="SCRIPTING_LANGUAGE" type="String" value="beanshell"/>
      <parameter id="_L6qjZtL2Eeik8NiUR3zizA" name="SCRIPTING_CONNECTION" type="String" value="${../CORE_PATH}$"/>
      <code>&#xD;
&#xD;
Object reader;&#xD;
try{&#xD;
reader=	new com.indy.runtime.file.DelimitedFileReader(new java.io.FileInputStream(&quot;%x{$REF/tech:sourceRef()/tech:filePath()}x%&quot;),&quot;%x{md:ifEmpty($sourceFile/@charsetName,'UTF-8')}x%&quot;);&#xD;
reader.setFieldSeparator(&quot;%x{$sourceFile/tech:asciiFieldSeparator()}x%&quot;);&#xD;
reader.setRowSeparator(&quot;%x{$sourceFile/tech:asciiLineSeparator()}x%&quot;,null);&#xD;
&#xD;
result=&quot;&quot;;&#xD;
index=0;&#xD;
for ( field: reader.readLine()){&#xD;
	index++;&#xD;
	String field2=field.toUpperCase().replace(&quot; &quot;,&quot;_&quot;).replace(&quot;.&quot;,&quot;_&quot;);&#xD;
	if (!result.isEmpty()){&#xD;
			result+=&quot;\n&quot;;&#xD;
		}&#xD;
	val=map.get(field);&#xD;
	if (val==null){&#xD;
		val=map.get(field2);&#xD;
	}&#xD;
	if (val!=null){&#xD;
		result+=index + &quot;	SQLCHAR	0	&quot;+val.columnSize+&quot;	&quot;+&quot;___FIELD_SEP___	&quot;+val.columnPos+&quot;	&quot;+val.workName+&quot;	\&quot;\&quot;&quot;;&#xD;
		&#xD;
	}else{&#xD;
		result+=index + &quot;	SQLCHAR	0	0	___FIELD_SEP___	0	&quot;+field+&quot;	\&quot;\&quot;&quot;;	&#xD;
	}&#xD;
}&#xD;
&#xD;
// replace field delimiters&#xD;
pos = result.lastIndexOf(&quot;___FIELD_SEP___&quot;);&#xD;
if(pos !=-1){&#xD;
	startstring = result.substring(0,pos);&#xD;
	endstring = result.substring(pos+16);&#xD;
	result = startstring + &quot;\&quot;%x{replace($sourceFile/tech:asciiLineSeparator(),'\\','\\\\')}x%\&quot;	&quot; + endstring;&#xD;
}&#xD;
result = result.replace(&quot;___FIELD_SEP___&quot;,&quot;\&quot;%x{$asciiFieldSeparator}x%\&quot;&quot;);&#xD;
result+=&quot;\n&quot;;&#xD;
&#xD;
__ctx__.publishVariable(&quot;../colList&quot;,result);&#xD;
__ctx__.publishVariable(&quot;../colCount&quot;,String.valueOf(index));&#xD;
&#xD;
}finally{&#xD;
	if (reader!=null){&#xD;
		reader.close();&#xD;
	}&#xD;
}&#xD;
&#xD;
</code>
    </actionCode>
    <actionCode id="_L6qjZ9L2Eeik8NiUR3zizA" enable="true" isBeginAction="false" name="Clean" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6qjadL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6rxg9L2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6qjatL2Eeik8NiUR3zizA" generationCondition="'${fileFormatMethod}$' = 'from_file_dynamic'" isBeginAction="false" name="Fill columns information" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.BeanScriptingActionCodeI">
      <link id="_L6qja9L2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6qjY9L2Eeik8NiUR3zizA"/>
      <parameter id="_L6qjbNL2Eeik8NiUR3zizA" name="SCRIPTING_LANGUAGE" type="String" value="beanshell"/>
      <parameter id="_L6qjbdL2Eeik8NiUR3zizA" name="SCRIPTING_CONNECTION" type="String" value="${../CORE_PATH}$"/>
      <code>map=new java.util.HashMap();&#xD;
&#xD;
	%xsl{	&#xD;
	&lt;xsl:for-each select=&quot;$cols/col[not(@filler='true')]&quot;>&#xD;
	column = null;&#xD;
	column = new ColumnInfo();&#xD;
	column.columnName = &quot;%x{@physicalName}x%&quot;;&#xD;
	column.columnSize = &quot;%x{@size}x%&quot;;&#xD;
	column.columnPos = &quot;%x{@position}x%&quot;;&#xD;
	column.workName = &quot;%x{@workName}x%&quot;;&#xD;
	map.put(&quot;%x{@physicalName}x%&quot;,column);&#xD;
	&lt;/xsl:for-each> &#xD;
	}xsl%	</code>
    </actionCode>
    <actionCode id="_L6qjbtL2Eeik8NiUR3zizA" isBeginAction="false" name="Start" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6qjb9L2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6qjZ9L2Eeik8NiUR3zizA"/>
      <link id="_L6qjcNL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6pVQNL2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6qjcdL2Eeik8NiUR3zizA" isBeginAction="false" name="generate format file" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6qjctL2Eeik8NiUR3zizA" generationCondition="" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6rxjNL2Eeik8NiUR3zizA"/>
      <link id="_L6qjc9L2Eeik8NiUR3zizA" generationCondition="" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6rxitL2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6qjdNL2Eeik8NiUR3zizA" generationCondition="not(md:paramValue($this, 'loadMethod')= 'BCP')" isBeginAction="false" name="BULK method" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.JdbcActionCodeI">
      <link id="_L6qjddL2Eeik8NiUR3zizA" executionType="OK" generationType="OK" mandatory="1"/>
      <parameter id="_L6qjdtL2Eeik8NiUR3zizA" name="SQL_CONNECTION" type="String" value="%targetConnection{$REF}%"/>
      <parameter id="_L6qjd9L2Eeik8NiUR3zizA" name="SQL_ACTION_TYPE" type="String" value="DDL_DML"/>
      <parameter id="_L6qjeNL2Eeik8NiUR3zizA" name="SQL_TRANSACTION_TYPE" type="String" value="AUTOCOMMIT"/>
      <code>BULK INSERT	%x{md:physicalPath($REF/ref:target(),'name')}x%
FROM 		'%x{$REF/ref:source()/tech:filePath()}x%'
WITH		(
			FORMATFILE =  '%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.fmt',
			ROWTERMINATOR = '%x{$REF/ref:source()/tech:asciiLineSeparator()}x%',
			CODEPAGE = '%x{md:paramValue($this,'codePage')}x%',
			FIRSTROW = %x{$REF/ref:source()/tech:header()+1}x%,
			ERRORFILE = '%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.bad'
		)
		
		</code>
    </actionCode>
    <actionCode id="_L6rxgNL2Eeik8NiUR3zizA" isBeginAction="false" name="clean end" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6rxgdL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6qjcdL2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6rxg9L2Eeik8NiUR3zizA" enable="true" isBeginAction="false" name="Delete format file" nbCycles="-1" toleratedError="true" technology="com.indy.engine.actionCodes.FileDeleteActionCodeI">
      <link id="_L6rxhNL2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6oHINL2Eeik8NiUR3zizA"/>
      <parameter id="_L6rxhdL2Eeik8NiUR3zizA" name="DEL_FILE" type="String" value="%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.fmt"/>
    </actionCode>
    <actionCode id="_L6rxhtL2Eeik8NiUR3zizA" generationCondition="'${fileFormatMethod}$' = 'from_file_dynamic'" isBeginAction="false" name="Class definition" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.BeanScriptingActionCodeI">
      <link id="_L6rxh9L2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6qjatL2Eeik8NiUR3zizA"/>
      <parameter id="_L6rxiNL2Eeik8NiUR3zizA" name="SCRIPTING_LANGUAGE" type="String" value="beanshell"/>
      <parameter id="_L6rxidL2Eeik8NiUR3zizA" name="SCRIPTING_CONNECTION" type="String" value="${../CORE_PATH}$"/>
      <code>import java.io.IOException;&#xD;
import java.lang.reflect.Array;&#xD;
import java.sql.ParameterMetaData;&#xD;
import java.sql.PreparedStatement;&#xD;
import java.sql.SQLException;&#xD;
import java.util.ArrayList;&#xD;
import java.util.Arrays;&#xD;
import java.util.Collections;&#xD;
import java.util.Enumeration;&#xD;
import java.util.HashMap;&#xD;
import java.util.List;&#xD;
import java.util.Map;&#xD;
&#xD;
public class ColumnInfo {&#xD;
&#xD;
	public String columnName = null;&#xD;
	public String columnSize = null;&#xD;
	public String columnPos = null;&#xD;
	public String workName = null;&#xD;
}</code>
    </actionCode>
    <actionCode id="_L6rxitL2Eeik8NiUR3zizA" generationCondition="$REF/tech:sourceRef()/tech:type() = 'P'" isBeginAction="false" name="Positional" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6rxi9L2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6pVR9L2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6rxjNL2Eeik8NiUR3zizA" generationCondition="$REF/tech:sourceRef()/tech:type() = 'D'" isBeginAction="false" name="Delimited" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_L6rxjdL2Eeik8NiUR3zizA" generationCondition="" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6pVTNL2Eeik8NiUR3zizA"/>
      <link id="_L6rxjtL2Eeik8NiUR3zizA" generationCondition="" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6s_otL2Eeik8NiUR3zizA"/>
    </actionCode>
    <actionCode id="_L6s_otL2Eeik8NiUR3zizA" generationCondition="$REF/tech:sourceRef()/tech:type() = 'D' and '${fileFormatMethod}$' = 'from_file_dynamic'" enable="true" isBeginAction="false" name="Delimited Format File - dynamic fields" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.WriteTxtFileActionCodeI">
      <link id="_L6s_o9L2Eeik8NiUR3zizA" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_4pqC0BlsEemU3dBcazn2tQ"/>
      <parameter id="_L6s_pNL2Eeik8NiUR3zizA" description="Name of the file" name="TXT_WRITE_FILENAME" type="String" value="%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.fmt"/>
      <code>%x{md:paramValue($this,'loaderVersion')}x%&#xD;
%e(rhino){colCount=__ctx__.getVariableValue(&quot;../colCount&quot;);colCount;}e(rhino)%&#xD;
%e(rhino){&#xD;
	colList=__ctx__.getVariableValue(&quot;../colList&quot;);&#xD;
	colList;&#xD;
}e(rhino)%</code>
    </actionCode>
    <actionCode id="_StuVIBTtEemJ-PVUNWIcUA" generationCondition="md:paramValue($this, 'loadMethod')= 'BCP'" enable="true" isBeginAction="false" name="BCP method" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.ScriptingActionCodeI">
      <parameter id="_StuVIRTtEemJ-PVUNWIcUA" description="Scripting language (Rhino, Jython, etc.)" name="SCRIPTING_LANGUAGE" type="String" value="rhino"/>
      <code>importPackage(java.lang);&#xD;
importPackage(java.io);&#xD;
&#xD;
dataFilePath = &quot;%x{$REF/ref:source()/tech:filePath()}x%&quot;;&#xD;
/*Append line separator to the last line&#xD;
&#xD;
dataFile = new BufferedWriter(new FileWriter(dataFilePath, true));&#xD;
dataFile.append(&quot;%x{md:ifEmpty(md:paramValue($this,'recordSeparator'),'\r\n')}x%&quot;);&#xD;
dataFile.close(); */&#xD;
&#xD;
&#xD;
tempFolder = &quot;${/CORE_JAVA_TEMPORARY_FOLDER}$&quot;;&#xD;
command = new java.lang.String();&#xD;
osName=System.getProperty(&quot;os.name&quot;).toLowerCase();&#xD;
&#xD;
ii=0;&#xD;
args=new Array();&#xD;
&#xD;
if (osName.startsWith(&quot;win&quot;)) {&#xD;
  command = command + &quot;cmd.exe /c &quot;;&#xD;
  args[ii++]=&quot;cmd.exe&quot;;&#xD;
  args[ii++]=&quot;/c&quot;;&#xD;
}&#xD;
command = command + &quot;bcp  %x{md:physicalPath($REF/ref:target(),'name')}x% IN \&quot;&quot; + dataFilePath + &quot;\&quot;&quot;;&#xD;
command = command + &quot; -c &quot;;&#xD;
if  ('%x{md:paramValue($this,'useTrustedConnection')}x%') {&#xD;
	command = command + &quot;-T &quot;;&#xD;
	}else{	&#xD;
		command = command + &quot;-U %x{$REF/ref:target()/tech:jdbcUser()}x% &quot;;&#xD;
	command = command + &quot;-P %x{$REF/ref:target()/tech:jdbcPassword()}x% &quot;; }&#xD;
command = command + &quot;-S \&quot;%x{replace($REF/ref:target()/tech:serverName(),&quot;\\&quot;,&quot;\\\\&quot;)}x%\&quot; &quot;;&#xD;
command = command + &quot;-t \&quot;%x{md:paramValue($this,'fieldSeparator')}x%\&quot; &quot;;&#xD;
command = command + &quot;-r \&quot;%x{md:ifEmpty(md:paramValue($this,'rowTerminator'),'\n')}x%\&quot; &quot;;&#xD;
%x{md:encloseIfNotEmpty(md:paramValue($this, 'maximumNumberOfErrors'), 'command = command + &quot;-m ', ' &quot;; ')}x%&#xD;
%x{md:encloseIfNotEmpty(md:paramValue($this, 'importBatchSize'), 'command = command + &quot;-b ', ' &quot;; ')}x%&#xD;
command=command + &quot;-f \&quot;%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.fmt\&quot;&quot;;&#xD;
&#xD;
command = command.replace(/\n/g, &quot;\\n&quot;);&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
args[ii++]=&quot;bcp&quot;;&#xD;
args[ii++]=&quot;%x{md:physicalPath($REF/ref:target(),'name')}x%&quot;;&#xD;
args[ii++]=&quot;IN&quot;;&#xD;
args[ii++]=&quot;dataFilePath&quot;;&#xD;
args[ii++]=&quot;-c&quot;;&#xD;
&#xD;
if  ('%x{md:paramValue($this,'useTrustedConnection')}x%' == 'true') {&#xD;
	args[ii++]=&quot;-T&quot;;&#xD;
}else{&#xD;
	args[ii++]=&quot;-U&quot;;&#xD;
	args[ii++]=&quot;%x{$REF/ref:target()/tech:jdbcUser()}x%&quot;;&#xD;
	args[ii++]=&quot;-P&quot;;&#xD;
	args[ii++]=&quot;%x{$REF/ref:target()/tech:jdbcPassword()}x%&quot;;&#xD;
}&#xD;
args[ii++]=&quot;-S&quot;;&#xD;
args[ii++]=&quot;%x{replace($REF/ref:target()/tech:serverName(),&quot;\\&quot;,&quot;\\\\&quot;)}x%&quot;;&#xD;
args[ii++]=&quot;-t&quot;;&#xD;
args[ii++]=&quot;\&quot;%x{md:paramValue($this,'fieldSeparator')}x%\&quot;&quot;;&#xD;
args[ii++]=&quot;-r&quot;;&#xD;
args[ii++]=&quot;\&quot;%x{replace(md:ifEmpty(md:paramValue($this,'rowTerminator'),'\n'),'\\n','\\\\n')}x%\&quot;&quot;;&#xD;
args[ii++]=&quot;-f&quot;;&#xD;
args[ii++]=&quot;%x{concat($REF/tech:sourceRef()/tech:directoryRef()/tech:path(),'/',$REF/tech:sourceRef()/tech:name())}x%.fmt&quot;;&#xD;
&#xD;
if  ('%x{md:paramValue($this,'maximumNumberOfErrors')}x%') {&#xD;
	args[ii++]=&quot;-m&quot;;&#xD;
	args[ii++]=&quot;%x{md:paramValue($this,'maximumNumberOfErrors')}x%&quot;;&#xD;
}&#xD;
&#xD;
if  ('%x{md:paramValue($this,'importBatchSize')}x%') {&#xD;
	args[ii++]=&quot;-b&quot;;&#xD;
	args[ii++]=&quot;%x{md:paramValue($this,'importBatchSize')}x%&quot;;&#xD;
}&#xD;
&#xD;
__ctx__.publishVariable(&quot;./BCP_COMMAND&quot;,args, true);&#xD;
//__ctx__.publishVariable(&quot;./BCP_COMMAND2&quot;,command, true);&#xD;
&#xD;
var psr;&#xD;
try{&#xD;
osRuntime = Runtime.getRuntime();&#xD;
osProc=osRuntime.exec(command, null, new File(tempFolder));&#xD;
//osProc=osRuntime.exec(args, null, new File(tempFolder));&#xD;
&#xD;
_in = new java.lang.StringBuffer();&#xD;
_err = new java.lang.StringBuffer();&#xD;
&#xD;
psr=com.indy.engine.common.tools.ProcessWrapper.wrap(osProc);&#xD;
psr.setInputStringBuffer(_in,-1);&#xD;
psr.setErrorStringBuffer(_err,-1);&#xD;
ret=psr.waitFor();&#xD;
&#xD;
if (_err.length()>0){&#xD;
	__ctx__.publishVariable(&quot;./BCP_ERROR&quot;,_err.toString(), true);&#xD;
}&#xD;
&#xD;
&#xD;
if (_in.length()>0){&#xD;
	str_out = _in.toString();&#xD;
	__ctx__.publishVariable(&quot;./BCP_STDOUT&quot;,str_out, true);&#xD;
}&#xD;
&#xD;
if (ret!= 0) {&#xD;
	throw &quot;The SQL Server BCP utility raised an error.&quot;;&#xD;
}&#xD;
}finally{&#xD;
	if (psr!=null) {&#xD;
		psr.destroy();&#xD;
	}&#xD;
	if (str_out != null){&#xD;
		str_exp_label = new java.lang.String(&quot; lignes copi&quot;);&#xD;
		indexOfStart = str_out.lastIndexOf(&quot;\n&quot;,str_out.indexOf(str_exp_label))+1;&#xD;
		/*__ctx__.publishVariable(&quot;./IndexStart&quot;,str_out.lastIndexOf(&quot;\n&quot;,str_out.indexOf(str_exp_label))+2, true);*/&#xD;
		__ctx__.publishVariable(&quot;./SQL_NB_ROWS&quot;,str_out.slice(indexOfStart,str_out.indexOf(&quot; &quot;,indexOfStart)), &quot;Integer&quot;, true);&#xD;
	}&#xD;
&#xD;
}&#xD;
&#xD;
</code>
    </actionCode>
    <actionCode id="_4pqC0BlsEemU3dBcazn2tQ" isBeginAction="false" name="load file" nbCycles="-1" toleratedError="false" technology="com.indy.engine.actionCodes.EmptyActionCodeI">
      <link id="_7Hld0BlsEemU3dBcazn2tQ" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_L6qjdNL2Eeik8NiUR3zizA"/>
      <link id="_7YwtYBlsEemU3dBcazn2tQ" executionType="OK" generationType="OK_KO" mandatory="1" targetId="_StuVIBTtEemJ-PVUNWIcUA"/>
    </actionCode>
    <templateType>I-TP.RDBMS.INTEGRATING</templateType>
    <xslVariable id="_L6rxgtL2Eeik8NiUR3zizA" code="%xsl{&#xD;&#xA;&lt;xsl:variable name=&quot;cols&quot; select=&quot;$mapCols/col&quot;/>&#xD;&#xA;&lt;xsl:variable name=&quot;srcCols&quot; select=&quot;$REF/ref:columns()[1]/ref:sources()[1]/../ref:fields()&quot;/>&#xD;&#xA;&lt;xsl:for-each select=&quot;$srcCols&quot;>&lt;xsl:sort select=&quot;number(@position)&quot; data-type=&quot;number&quot;/>&#xD;&#xA;&#x9;&lt;col>&#xD;&#xA;&#x9;&#x9;&lt;xsl:attribute name=&quot;myTest&quot;>&lt;xsl:value-of select=&quot;current()/@id&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&lt;xsl:variable name=&quot;map&quot; select=&quot;$cols[@id=current()/@id]&quot;/>&#xD;&#xA;&#x9;&#x9;&lt;xsl:choose>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;xsl:when test=&quot;exists($map)&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;position&quot;>&lt;xsl:value-of select=&quot;$map/@pos&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;size&quot;>&lt;xsl:value-of select=&quot;current()/tech:size()&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;workName&quot;>&lt;xsl:value-of select=&quot;$map/@workName&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;physicalName&quot;>&lt;xsl:value-of select=&quot;current()/tech:name()&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;isLast&quot;>&lt;xsl:value-of select=&quot;if (position()=last()) then 'true' else 'false'&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineDelim&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;','___FIELD_SEP___','&amp;quot;\t',$map/@pos,'\t',$map/@workName,'\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;linePos&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(position(),'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;','&amp;quot;\t',$map/@pos,'\t',$map/@workName,'\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineBegPos&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(position(),'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineEnd&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat('&amp;quot;\t',$map/@pos,'\t',$map/@workName,'\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineBegDelim&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;/xsl:when>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;filler&quot;>&lt;xsl:value-of select=&quot;true&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;isLast&quot;>&lt;xsl:value-of select=&quot;if (position()=last()) then 'true' else 'false'&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineDelim&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;','___FIELD_SEP___','&amp;quot;\t',0,'\tFILLER\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;linePos&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(position(),'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;','&amp;quot;\t',0,'\tFILLER\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineBegPos&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(position(),'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineEnd&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;'&amp;quot;\t0\tFILLER\t&amp;quot;&amp;quot;'&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineBegDelim&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;/xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&lt;/xsl:choose>&#xD;&#xA;&#x9;&lt;/col>&#xD;&#xA;&lt;/xsl:for-each>&#xD;&#xA;}%" name="cols" order="1" type="xsl"/>
    <xslVariable id="_L6s_oNL2Eeik8NiUR3zizA" code="%xsl{&#xD;&#xA;&#xD;&#xA;&lt;xsl:variable name=&quot;srcTab&quot; select=&quot;$REF/ref:sources()[1]&quot;/>&#xD;&#xA;&lt;xsl:variable name=&quot;cols&quot; select=&quot;$REF/ref:columns()&quot;/>&#xD;&#xA;&lt;xsl:variable name=&quot;srcCols&quot; select=&quot;$cols[1]/ref:sources()[1]/../ref:fields()&quot;/>&#xD;&#xA;&lt;xsl:for-each select=&quot;$srcCols&quot;>&lt;xsl:sort select=&quot;number(@position)&quot; data-type=&quot;number&quot;/>&#xD;&#xA;&#x9;&lt;col>&#xD;&#xA;&#x9;&#x9;&lt;xsl:variable name=&quot;map&quot; select=&quot;$cols[ref:sources()[1]/@id=current()/@id]&quot;/>&#xD;&#xA;&#x9;&#x9;&lt;xsl:choose>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;xsl:when test=&quot;exists($map)&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:variable name=&quot;cur&quot; select=&quot;current()&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;xsl:for-each select=&quot;$REF/ref:columns()&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;xsl:choose>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;xsl:when test=&quot;$cur/@id=current()/ref:sources()[1]/@id&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;pos&quot;>&lt;xsl:value-of select=&quot;current()/position()&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:when>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;pos&quot;>&lt;xsl:value-of select=&quot;-1&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:choose>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:for-each>&#xD;&#xA;&#x9;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;isLast&quot;>&lt;xsl:value-of select=&quot;if (position()=last()) then 'true' else 'false'&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;line&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;',current()/../tech:asciiFieldSeparator(),'&amp;quot;\t',position(),'\t',$map/tech:workName(),'\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineBeg&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineEnd&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat('&amp;quot;\t',position(),'\t',$map/tech:workName(),'\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;/xsl:when>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;isLast&quot;>&lt;xsl:value-of select=&quot;if (position()=last()) then 'true' else 'false'&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;line&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;',current()/../tech:asciiFieldSeparator(),'&amp;quot;\t',0,'\tFILLER\t&amp;quot;&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineBeg&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;concat(current()/@position,'\tSQLCHAR\t0\t',current()/tech:size(),'\t&amp;quot;')&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;lineEnd&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:value-of select=&quot;'&amp;quot;\t0\tFILLER\t&amp;quot;&amp;quot;'&quot;/>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;/xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&lt;/xsl:choose>&#xD;&#xA;&#x9;&lt;/col>&#xD;&#xA;&lt;/xsl:for-each>&#xD;&#xA;}%" name="colsOldTest" type="xsl"/>
    <xslVariable id="_L6s_odL2Eeik8NiUR3zizA" code="%xsl{&#xD;&#xA;&#xD;&#xA;&lt;xsl:variable name=&quot;cols&quot; select=&quot;$REF/ref:columns()&quot;/>&#xD;&#xA;&lt;xsl:variable name=&quot;srcCols&quot; select=&quot;$cols[1]/ref:sources()[1]/../ref:fields()&quot;/>&#xD;&#xA;&#xD;&#xA;&lt;xsl:for-each select=&quot;$cols&quot;>&lt;xsl:sort select=&quot;number(@num)&quot; data-type=&quot;number&quot;/>&#xD;&#xA;&#x9;&lt;col>&#xD;&#xA;&#x9;&#x9;&lt;xsl:variable name=&quot;map&quot; select=&quot;$srcCols[@id=current()/ref:sources()[1]/@id]&quot;/>&#xD;&#xA;&#x9;&#x9;&lt;xsl:choose>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;xsl:when test=&quot;exists($map)&quot;>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;id&quot;>&lt;xsl:value-of select=&quot;current()/ref:sources()[1]/@id&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;pos&quot;>&lt;xsl:value-of select=&quot;position()&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;workName&quot;>&lt;xsl:value-of select=&quot;tech:workName()&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;/xsl:when>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;id&quot;>&lt;xsl:value-of select=&quot;current()/ref:sources()[1]/@id&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;pos&quot;>&lt;xsl:value-of select=&quot;-1&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&lt;xsl:attribute name=&quot;workName&quot;>&lt;xsl:value-of select=&quot;tech:workName()&quot;/>&lt;/xsl:attribute>&#xD;&#xA;&#x9;&#x9;&#x9;&lt;/xsl:otherwise>&#xD;&#xA;&#x9;&#x9;&lt;/xsl:choose>&#xD;&#xA;&#x9;&lt;/col>&#xD;&#xA;&lt;/xsl:for-each>&#xD;&#xA;}%" name="mapCols" type="xsl"/>
    <xslVariable id="_L6s_pdL2Eeik8NiUR3zizA" code="$REF/ref:sources()[1]" name="sourceFile" type="xpath"/>
    <xslVariable id="_L6s_ptL2Eeik8NiUR3zizA" code="$REF/ref:columns()[1]/ref:sources()[1]/../ref:fields()/../tech:asciiFieldSeparator()" name="asciiFieldSeparator" type="xpath"/>
  </subProcess>
  <templateType>I-TP.RDBMS</templateType>
</proc:process>